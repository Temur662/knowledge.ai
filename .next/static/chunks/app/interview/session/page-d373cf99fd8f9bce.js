(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[425],{767:(e,t,s)=>{"use strict";s.d(t,{$:()=>l});var n=s(5155),i=s(2115),o=s(4624),r=s(2085),a=s(4143);let c=(0,r.F)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",{variants:{variant:{default:"bg-indigo-600 text-white hover:bg-indigo-700",destructive:"bg-red-500 text-white hover:bg-red-600",outline:"border border-input hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"underline-offset-4 hover:underline text-indigo-600"},size:{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),l=i.forwardRef((e,t)=>{let{className:s,variant:i,size:r,asChild:l=!1,...d}=e,h=l?o.DX:"button";return(0,n.jsx)(h,{className:(0,a.cn)(c({variant:i,size:r,className:s})),ref:t,...d})});l.displayName="Button"},2876:(e,t,s)=>{Promise.resolve().then(s.bind(s,5693))},4143:(e,t,s)=>{"use strict";s.d(t,{cn:()=>o});var n=s(2596),i=s(9688);function o(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,i.QP)((0,n.$)(t))}},5693:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var n=s(5155),i=s(2115),o=s(5695),r=s(767),a=s(4143),c=s(2682),l=s(4202),d=s(3465),h=s(6506),u=s(7630);async function g(e,t,s){try{let n=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,interviewType:t,topic:s,action:"response"})});if(!n.ok)throw Error("AI response error: ".concat(n.status));return(await n.json()).response}catch(e){return console.error("Error generating AI response:",e),"I apologize, but I'm experiencing technical difficulties. Let's try again in a moment."}}async function m(e,t,s){try{let n=await fetch("/api/ai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:e,interviewType:t,topic:s,action:"feedback"}),signal:AbortSignal.timeout(3e4)});if(!n.ok)throw Error("AI feedback error: ".concat(n.status));return(await n.json()).feedback}catch(e){return console.error("Error generating feedback:",e),{summary:"Session completed. There was an issue generating detailed feedback.",strengths:["Completed the interview session"],improvements:["Try another session"]}}}var p=s(3764),x=s(9509);let f=new p.l7({apiKey:x.env.NEXT_PUBLIC_ASSEMBLYAI_API_KEY||""}),y={isSpeaking:!1,utterances:[],debug:!0,watchdogTimer:null,voicesLoaded:!1,preferredVoice:null,voiceInitAttempts:0,isSafari:!1,isMacOS:!1};async function w(e){try{let t=await f.transcripts.transcribe({audio:e});if("completed"===t.status)return t.text||"";return console.error("Transcription status:",t.status),""}catch(e){return console.error("Error transcribing audio:",e),""}}function v(){if(!("speechSynthesis"in window))return null;if(y.preferredVoice)return y.preferredVoice;let e=window.speechSynthesis.getVoices();if(0===e.length){if(y.voiceInitAttempts<3){if(y.voiceInitAttempts++,window.speechSynthesis){let e=new SpeechSynthesisUtterance("");window.speechSynthesis.speak(e),window.speechSynthesis.cancel()}y.debug&&console.log("Voice initialization attempt ".concat(y.voiceInitAttempts))}return null}y.debug&&console.log("Found ".concat(e.length," voices available"));let t=e.find(e=>e.name.includes("Google US English")||e.name.includes("Google UK English")),s=e.find(e=>e.name.includes("Microsoft")&&e.lang.startsWith("en")),n=e.find(e=>e.name.includes("Samantha")||e.name.includes("Alex")||e.name.includes("en-US")&&!0===e.localService),i=e.find(e=>"en-US"===e.lang),o=e.find(e=>e.lang.startsWith("en"));return y.preferredVoice=t||s||n||i||o||e[0],y.debug&&y.preferredVoice&&console.log("Selected voice: ".concat(y.preferredVoice.name," (").concat(y.preferredVoice.lang,")")),y.preferredVoice}let b=()=>{"speechSynthesis"in window&&(y.debug&&console.log("Stopping all speech"),window.speechSynthesis.cancel(),y.isSpeaking=!1,y.utterances=[])};function S(){return new Promise(e=>{if(!("speechSynthesis"in window)){console.error("Speech synthesis not available"),e(!1);return}if(y.voicesLoaded&&y.preferredVoice)return void e(!0);console.log("Force initializing voices..."),window.speechSynthesis.cancel();let t=new SpeechSynthesisUtterance("");t.volume=0,t.onend=()=>{window.speechSynthesis.getVoices().length>0?(y.voicesLoaded=!0,v(),console.log("Voices initialized by force speak"),e(!0)):(console.warn("Force speak completed but no voices loaded"),e(!1))},t.onerror=()=>{console.warn("Error during force voice initialization"),window.speechSynthesis.getVoices().length>0?(y.voicesLoaded=!0,v(),e(!0)):e(!1)};try{if(window.speechSynthesis.getVoices().length>0){y.voicesLoaded=!0,v(),console.log("Voices loaded immediately"),e(!0);return}window.speechSynthesis.speak(t),setTimeout(()=>{y.voicesLoaded||(window.speechSynthesis.getVoices().length>0?(y.voicesLoaded=!0,v(),console.log("Voices loaded via timeout"),e(!0)):(console.warn("Failed to load voices after multiple attempts"),e(!1)))},1e3)}catch(t){console.error("Error in force voice initialization:",t),e(!1)}})}function j(e){var t;let{topic:s,sessionType:o="mock",onEnd:p,className:x,details:f={},notes:j=""}=e,[N,k]=(0,i.useState)([]),[I,T]=(0,i.useState)(!1),[C,E]=(0,i.useState)(""),[A,V]=(0,i.useState)(!1),[O,L]=(0,i.useState)(!1),[D,z]=(0,i.useState)(!1),[F,P]=(0,i.useState)(!1),[J,U]=(0,i.useState)(""),[W,q]=(0,i.useState)(null),[R,M]=(0,i.useState)([]),[$,_]=(0,i.useState)(!1),[B,Y]=(0,i.useState)(0),[H,K]=(0,i.useState)(""),[G,Q]=(0,i.useState)(null),[X,Z]=(0,i.useState)(1),ee=(0,i.useRef)([]),et=(0,i.useRef)(null),es=(0,i.useRef)(null);(0,i.useEffect)(()=>{let e="Hello! I'll be interviewing you about ".concat(s,' today. Click "Connect" to begin our conversation.');"topic"===o?e="Welcome to your lecture on ".concat(s,". Click \"Connect\" to begin our session. I'll start with an overview and then we'll dive into the details."):"qa"===o?e="Welcome to your Q&A session on ".concat(s,'. Click "Connect" to begin. I\'ll be testing your knowledge with a series of questions.'):"language"===o&&(e='Bonjour! Welcome to your language practice session. Click "Connect" to begin. Today we\'ll be practicing '.concat(s,".")),k([{id:"welcome",content:e,role:"assistant",timestamp:new Date}])},[s,o]),(0,i.useEffect)(()=>{if(console.log("Initializing speech synthesis for interview session..."),"speechSynthesis"in window)return!function(){if(!("speechSynthesis"in window))return console.error("Speech synthesis not available");let e=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),t=/Mac/.test(navigator.platform);y.isSafari=e,y.isMacOS=t,y.debug&&console.log("Browser detection: Safari=".concat(e,", macOS=").concat(t)),y.debug&&console.log("Initializing speech synthesis..."),window.speechSynthesis.cancel();let s=window.speechSynthesis.getVoices();if(0===s.length){window.speechSynthesis.onvoiceschanged=()=>{let e=window.speechSynthesis.getVoices();y.voicesLoaded=e.length>0,y.debug&&console.log("Voices loaded: ".concat(e.length," voices available")),v()};let e=new SpeechSynthesisUtterance("");if(window.speechSynthesis.speak(e),window.speechSynthesis.cancel(),window.speechSynthesis.getVoices(),y.isSafari||y.isMacOS){let e=()=>window.speechSynthesis.getVoices().length>0&&(y.voicesLoaded=!0,v(),!0);e()||setTimeout(()=>{e()||setTimeout(e,300)},100)}else setTimeout(()=>{!y.voicesLoaded&&window.speechSynthesis.getVoices().length>0&&(y.voicesLoaded=!0,v())},100)}else y.voicesLoaded=!0,y.debug&&console.log("Speech synthesis initialized with ".concat(s.length," voices")),v();y.watchdogTimer&&clearInterval(y.watchdogTimer),y.watchdogTimer=setInterval(()=>{"speechSynthesis"in window&&y.isSpeaking&&!window.speechSynthesis.speaking&&y.utterances.length>0&&(y.debug&&console.log("Watchdog detected stalled speech, restarting..."),window.speechSynthesis.resume())},3e3)}(),setTimeout(async()=>{try{console.log("Trying force voice initialization...");let e=await S();if(console.log("Force voice initialization result:",e),e){let e=new SpeechSynthesisUtterance("Test");e.volume=0,window.speechSynthesis.speak(e)}}catch(e){console.error("Voice initialization error:",e)}},500),()=>{console.log("Cleaning up speech synthesis..."),y.watchdogTimer&&(clearInterval(y.watchdogTimer),y.watchdogTimer=null),b()};console.error("Speech synthesis not available in this browser")},[]),(0,i.useEffect)(()=>(F&&(et.current=setInterval(()=>{Y(e=>e+1)},1e3)),()=>{et.current&&clearInterval(et.current)}),[F]),(0,i.useEffect)(()=>{let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(e){let t=new e;t.continuous=!0,t.interimResults=!0,t.lang="en-US",t.onresult=e=>{let t="",s="";for(let n=e.resultIndex;n<e.results.length;n++){let i=e.results[n][0].transcript;e.results[n].isFinal?s+=i:t+=i}s?K(s):t&&K(t)},t.onerror=e=>{console.error("Speech recognition error:",e.error)},es.current=t,Q(t)}return()=>{if(es.current)try{es.current.stop()}catch(e){}}},[]);let en=async()=>{try{if(!navigator.mediaDevices)throw Error("Media devices not available in this browser or context");let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);t.addEventListener("dataavailable",eo),t.addEventListener("stop",er),q(t),P(!0),setTimeout(()=>ei(),1e3)}catch(e){console.error("Error setting up audio recording:",e),alert("Could not access microphone. Voice input will not be available."),P(!0),setTimeout(()=>ei(),1e3)}},ei=async()=>{try{V(!0);let e="Great! Let's start our interview about ".concat(s,". I'll ask you some questions about ").concat(s," and you can respond either by speaking or typing your answers.");if("topic"===o)e="Welcome to your lecture on ".concat(s,". I'll start with an overview and then we'll dive into the details. Feel free to ask questions at any point.");else if("qa"===o)e="Welcome to your Q&A session on ".concat(s,". I'll be testing your knowledge with a series of questions. Let's see how much you know about ").concat(s,"!");else if("language"===o)e="Bonjour! Welcome to your language practice session. Today we'll be practicing ".concat(s,". I'll speak in the language we're practicing, and you can respond to improve your skills.");else if("mock"===o){let t=f.role||s,n=f.company||"a company",i=f.experience||"this role",o=f.specificSkills||"";e="Welcome to your mock interview for the ".concat(t," position at ").concat(n,". I'll be your interviewer today. I'll ask you questions related to ").concat(s," and your experience with ").concat(i,"."),o&&(e+=" I'll focus particularly on your skills with ".concat(o,".")),e+=" Let's begin!"}let t={id:Date.now().toString(),topic:s,type:o,startTime:new Date().toISOString()};sessionStorage.setItem("interviewSession",JSON.stringify(t));let n={id:Date.now().toString(),content:e,role:"assistant",timestamp:new Date};k(e=>[...e,n]);try{let e=await fetch("/api/create-interview",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({topic:s,type:o,notes:j})});if(e.ok){let s=await e.json();s.id&&(t.id=s.id,sessionStorage.setItem("interviewSession",JSON.stringify(t)))}}catch(e){console.error("Error saving session:",e)}console.log("Starting to speak introduction..."),setTimeout(async()=>{try{await S();let t=new SpeechSynthesisUtterance(e);if(t.rate=X,window.speechSynthesis.getVoices().length>0){let e=window.speechSynthesis.getVoices().find(e=>"en-US"===e.lang||e.lang.startsWith("en"));e&&(t.voice=e)}z(!0),t.onend=()=>{z(!1),console.log("Introduction speech completed")},t.onerror=e=>{console.error("Error during introduction speech:",e),z(!1)},window.speechSynthesis.speak(t),window.speechSynthesis.resume()}catch(e){console.error("Error in speak introduction:",e),z(!1)}},800)}catch(e){console.error("Error starting interview:",e),alert("There was an error starting the interview. Please try again later.")}finally{V(!1)}},eo=e=>{e.data.size>0&&ee.current.push(e.data)},er=async()=>{let e=new Blob(ee.current,{type:"audio/wav"});ee.current=[];try{V(!0);let t=await w(e);V(!1),t?(E(t),U(t),ed(t)):E("")}catch(e){console.error("Error transcribing audio:",e),alert("There was an error processing your speech. Please try again or use text input."),V(!1)}},ea=e=>{Z(e),D&&Z(e)},ec=async e=>{if(e&&F){console.log("PlayAudioResponse called with text length:",e.length),z(!0);try{console.log("Starting text-to-speech for AI response..."),await S();let t=new SpeechSynthesisUtterance(e);if(t.rate=X,window.speechSynthesis.getVoices().length>0){let e=window.speechSynthesis.getVoices().find(e=>"en-US"===e.lang||e.lang.startsWith("en"));e&&(t.voice=e)}t.onend=()=>{z(!1),console.log("AI response speech completed")},t.onerror=e=>{console.error("Error during AI response speech:",e),z(!1)},window.speechSynthesis.cancel(),window.speechSynthesis.speak(t),window.speechSynthesis.resume(),console.log("Speech synthesis request sent to browser")}catch(e){console.error("Error playing audio:",e),z(!1)}}},el=()=>{"speechSynthesis"in window&&D&&(b(),z(!1))},ed=async e=>{let t="";if(!(t=H||e||C).trim())return;let n={id:Date.now().toString(),content:t.trim(),role:"user",timestamp:new Date};k(e=>[...e,n]),E(""),U(""),K(""),V(!0);let i=JSON.parse(sessionStorage.getItem("interviewSession")||"{}");if(null==i?void 0:i.id)try{fetch("/api/save-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interviewId:i.id,content:n.content,role:"user"})}).catch(e=>{console.warn("API error when saving message, continuing anyway:",e)})}catch(e){console.error("Error saving message:",e)}L(!0);try{var r,a,c,l,d,h,u;let e=N.map(e=>({role:e.role,content:e.content}));e.push({role:"user",content:n.content});let t=(null==f||null==(r=f.focusAreas)?void 0:r.join(",").toLowerCase().includes("system design"))?"system design interview":(null==f||null==(a=f.focusAreas)?void 0:a.join(",").toLowerCase().includes("leetcode"))||(null==f||null==(c=f.focusAreas)?void 0:c.join(",").toLowerCase().includes("coding"))?"coding interview with algorithm problems":(null==f||null==(l=f.focusAreas)?void 0:l.join(",").toLowerCase().includes("react"))||(null==f||null==(d=f.focusAreas)?void 0:d.join(",").toLowerCase().includes("front"))?"front-end development interview":(null==f||null==(h=f.focusAreas)?void 0:h.join(",").toLowerCase().includes("back"))?"back-end development interview":"".concat(o," interview"),m="mock"===o?"You are an expert interviewer conducting a ".concat(t," for the position of ").concat(s,". \n           Stay strictly focused on ").concat((null==f||null==(u=f.focusAreas)?void 0:u.join(", "))||s," without getting sidetracked by personal details. \n           Ask technical questions appropriate for a ").concat((null==f?void 0:f.experience)||"mid-level"," position.\n           ").concat(j?"ADDITIONAL CONTEXT (not to be mentioned directly): "+j:""):o,p=await g(e,m,s),x={id:Date.now().toString(),content:p,role:"assistant",timestamp:new Date};if(k(e=>[...e,x]),null==i?void 0:i.id)try{fetch("/api/save-message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interviewId:i.id,content:p,role:"assistant"})}).catch(e=>{console.warn("API error when saving AI message, continuing anyway:",e)})}catch(e){console.error("Error saving AI message:",e)}L(!1),V(!1),setTimeout(()=>{window.speechSynthesis&&window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),ec(p).catch(e=>console.error("Error playing AI response audio:",e))},500)}catch(t){console.error("Error generating AI response:",t);let e={id:Date.now().toString(),content:"I'm sorry, I'm having trouble responding right now. Let's continue our conversation.",role:"assistant",timestamp:new Date};k(t=>[...t,e]),L(!1),V(!1)}},eh=async()=>{if($)return;_(!0),window.speechSynthesis.speaking&&window.speechSynthesis.cancel(),W&&"recording"===W.state&&W.stop(),et.current&&clearInterval(et.current);let e=N.map(e=>({role:e.role,content:e.content}));try{L(!0);let t=await m(e,o,s),n=JSON.parse(sessionStorage.getItem("interviewSession")||"{}");if(null==n?void 0:n.id)try{await fetch("/api/save-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interviewId:n.id,feedback:t})})}catch(e){console.error("Error saving feedback:",e)}p(t)}catch(n){console.error("Error generating feedback:",n);let e={summary:"You participated in this ".concat(o," about ").concat(s,"."),strengths:["Engaged in the ".concat(o),"Provided responses to questions","Completed the session"],improvements:["Technical issues prevented detailed feedback","Try another session with a different connection","Consider trying a different topic"]},t=JSON.parse(sessionStorage.getItem("interviewSession")||"{}");if(null==t?void 0:t.id)try{await fetch("/api/save-feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interviewId:t.id,feedback:e})})}catch(e){console.error("Error saving fallback feedback:",e)}p(e)}finally{L(!1),_(!1)}},eu=async()=>{console.log("Testing voice..."),z(!0);try{await S();let e=new SpeechSynthesisUtterance("Hello, this is a test of the voice system. If you can hear this, the voice system is working correctly.");if(e.rate=X,window.speechSynthesis.getVoices().length>0){let t=window.speechSynthesis.getVoices().find(e=>"en-US"===e.lang||e.lang.startsWith("en"));t&&(e.voice=t)}e.onend=()=>{z(!1),console.log("Test voice completed successfully")},e.onerror=e=>{console.error("Error during test voice:",e),z(!1),alert("Voice test failed. Your browser may not fully support speech synthesis. Try using Chrome for the best experience.")},window.speechSynthesis.cancel(),window.speechSynthesis.speak(e),window.speechSynthesis.resume()}catch(e){console.error("Voice test failed:",e),z(!1),alert("Voice test failed. Your browser may not fully support speech synthesis. Try using Chrome for the best experience.")}},eg=()=>{switch(o){case"topic":return"Topic Lecture: ".concat(s);case"qa":return"Q&A Session: ".concat(s);case"language":return"Language Practice: ".concat(s);default:return"Interview: ".concat(s)}};return(0,n.jsxs)("div",{className:(0,a.cn)("flex flex-col h-full bg-white rounded-xl shadow-lg overflow-hidden",x),children:[(0,n.jsxs)("div",{className:"p-4 border-b flex justify-between items-center bg-indigo-50",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-indigo-800",children:eg()}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[F&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("button",{onClick:el,className:"p-1 rounded ".concat(D?"bg-red-100 text-red-800 hover:bg-red-200":"bg-gray-100 text-gray-400"),disabled:!D,"aria-label":"Stop speaking",title:"Skip AI speaking",children:(0,n.jsx)(c.A,{className:"h-4 w-4"})}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"text-xs text-gray-700 mr-1 font-medium",children:"Speed:"}),(0,n.jsxs)("select",{value:X,onChange:e=>ea(parseFloat(e.target.value)),className:"text-xs bg-indigo-100 border border-indigo-200 rounded px-2 py-1 text-gray-800",children:[(0,n.jsx)("option",{value:"0.8",children:"Slow"}),(0,n.jsx)("option",{value:"1.0",children:"Normal"}),(0,n.jsx)("option",{value:"1.3",children:"Fast"}),(0,n.jsx)("option",{value:"1.6",children:"Faster"}),(0,n.jsx)("option",{value:"2.0",children:"Fastest"})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-1 text-indigo-700 font-medium",children:[(0,n.jsx)(l.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:(e=>{let t=Math.floor(e/60);return"".concat(t.toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"))})(B)})]})]}),(0,n.jsx)(r.$,{variant:"ghost",size:"sm",onClick:eh,disabled:$||!F,className:(0,a.cn)("text-gray-500 hover:text-gray-700",$&&"opacity-50 cursor-not-allowed"),children:(0,n.jsx)(d.A,{className:"w-5 h-5"})})]})]}),(0,n.jsxs)("div",{className:"flex flex-1 overflow-hidden",children:[(0,n.jsx)("div",{className:"w-2/3 border-r flex flex-col",children:(0,n.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col",children:[(0,n.jsx)("div",{className:"flex flex-col space-y-1 p-4 h-full overflow-y-auto",children:N.map(e=>(0,n.jsxs)("div",{className:(0,a.cn)("flex items-start gap-3 p-4 rounded-lg max-w-[85%] mb-3","assistant"===e.role?"self-start bg-gray-100":"self-end bg-indigo-600 text-white"),children:["assistant"===e.role&&(0,n.jsx)("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center text-xl",children:"topic"===o?"\uD83D\uDC69‍\uD83C\uDFEB":"\uD83D\uDC69‍\uD83D\uDCBC"}),(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsx)("div",{className:(0,a.cn)("text-sm","assistant"===e.role?"text-gray-800":"text-white"),children:e.content}),(0,n.jsx)("div",{className:(0,a.cn)("text-xs mt-1","assistant"===e.role?"text-gray-500":"text-indigo-100"),children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),"user"===e.role&&(0,n.jsx)("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-xl",children:"\uD83D\uDC64"})]},e.id))}),(0,n.jsx)("div",{className:"p-4 border-t",children:F?(0,n.jsxs)(n.Fragment,{children:[J&&(0,n.jsxs)("div",{className:"mb-2 p-2 bg-gray-50 rounded text-sm text-gray-700",children:[(0,n.jsx)("p",{className:"font-semibold text-xs mb-1",children:"Transcript:"}),J]}),H&&(0,n.jsxs)("div",{className:"mb-2 p-2 bg-gray-50 border border-indigo-100 rounded text-sm text-gray-700",children:[(0,n.jsxs)("p",{className:"font-semibold text-xs mb-1 flex items-center",children:[(0,n.jsx)("span",{className:"w-2 h-2 bg-indigo-600 rounded-full animate-pulse mr-1"}),"Live Transcript:"]}),H]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("textarea",{value:C,onChange:e=>E(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ed())},placeholder:I?"Listening...":D?"AI is speaking...":"Type your response...",className:"flex-1 p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500",rows:2,disabled:A||I||D}),(0,n.jsx)("div",{className:"flex flex-col space-y-2",children:(0,n.jsx)(r.$,{type:"button",size:"sm",variant:I?"destructive":"default",onClick:I?()=>{if(es.current)try{es.current.stop()}catch(e){console.error("Failed to stop recognition:",e)}W&&"recording"===W.state&&W.stop(),T(!1)}:()=>{if(!W)return void alert("Microphone is not available. Please try again or use text input.");if(!D){if(T(!0),U(""),K(""),es.current)try{es.current.start()}catch(e){console.error("Failed to start recognition:",e)}ee.current=[],W.start()}},disabled:A||!W||D,className:(0,a.cn)("rounded-full w-10 h-10 p-0 flex items-center justify-center",I?"animate-pulse bg-red-500":"",D?"opacity-50 cursor-not-allowed":""),children:I?(0,n.jsx)(h.A,{className:"w-5 h-5"}):(0,n.jsx)(u.A,{className:"w-5 h-5"})})})]})]}):(0,n.jsxs)("div",{className:"w-full h-[600px] flex flex-col items-center justify-center p-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-4",children:eg()}),(0,n.jsx)("p",{className:"text-lg mb-8",children:null==(t=N[0])?void 0:t.content}),(0,n.jsxs)("div",{className:"flex flex-col space-y-4",children:[(0,n.jsx)(r.$,{onClick:()=>{en()},className:"px-8 py-4",children:"Connect"}),(0,n.jsx)(r.$,{onClick:eu,className:"px-8 py-2 bg-gray-700 hover:bg-gray-600",disabled:D,children:D?"Testing Voice...":"Test Voice"}),D&&(0,n.jsxs)("div",{className:"flex flex-col items-center space-y-2 mt-2",children:[(0,n.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,n.jsx)("span",{className:"text-sm",children:"Speaking now... You should hear audio"})]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["If you don't hear anything, check your system volume and browser permissions.",(0,n.jsx)("br",{}),"Speech synthesis works best in Chrome and Safari."]})]})]})]})})]})}),(0,n.jsx)("div",{className:"w-1/3 p-6 flex flex-col items-center justify-center bg-gradient-to-br from-indigo-50 to-purple-50",children:(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-24 h-24 bg-indigo-100 rounded-full flex items-center justify-center text-5xl mb-4",children:"topic"===o?"\uD83D\uDC69‍\uD83C\uDFEB":"\uD83D\uDC69‍\uD83D\uDCBC"}),(0,n.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:O?"Thinking...":D?"Speaking...":"Joanna"}),(0,n.jsx)("p",{className:"text-sm text-gray-700 text-center font-medium",children:O?"Analyzing your response...":D?"Please wait until I finish speaking":F?"I'm here to ".concat("topic"===o?"teach":"qa"===o?"quiz":"interview"," you about ").concat(s):"Click 'Connect' to start our session"}),(O||D)&&(0,n.jsxs)("div",{className:"mt-4 flex space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-indigo-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-indigo-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-indigo-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),D&&(0,n.jsx)("div",{className:"mt-4 flex flex-col items-center",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,n.jsx)(r.$,{size:"sm",onClick:el,className:"bg-red-500 hover:bg-red-600 text-white",children:"Skip"}),(0,n.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,n.jsx)("span",{className:"text-xs text-gray-700 font-medium",children:"Speed:"}),(0,n.jsxs)("select",{value:X,onChange:e=>ea(parseFloat(e.target.value)),className:"text-xs border border-gray-300 rounded p-1 bg-white text-gray-800",children:[(0,n.jsx)("option",{value:"0.8",children:"0.8x"}),(0,n.jsx)("option",{value:"1.0",children:"1.0x"}),(0,n.jsx)("option",{value:"1.2",children:"1.2x"}),(0,n.jsx)("option",{value:"1.5",children:"1.5x"}),(0,n.jsx)("option",{value:"2.0",children:"2.0x"})]})]})]})}),F&&!O&&!D&&(0,n.jsx)(r.$,{onClick:eh,disabled:$,className:(0,a.cn)("mt-6 bg-indigo-100 hover:bg-indigo-200 text-indigo-800 px-6 py-2 rounded-lg shadow-sm font-medium",$&&"opacity-50 cursor-not-allowed"),children:"End Session & Get Feedback"})]})})]}),(0,n.jsx)("div",{className:"absolute bottom-20 right-4 flex flex-col items-end space-y-2",children:F&&(0,n.jsx)(n.Fragment,{children:D&&(0,n.jsxs)("div",{className:"bg-white/90 backdrop-blur-md p-2 rounded-lg shadow-md flex items-center space-x-2 border border-gray-200",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,n.jsx)("span",{className:"text-xs font-medium text-gray-800",children:"Speaking"})]}),(0,n.jsx)("button",{onClick:el,className:"p-1 rounded-full bg-red-500/80 hover:bg-red-500 transition-colors",title:"Stop speaking",children:(0,n.jsx)(c.A,{className:"w-4 h-4 text-white"})})]})})})]})}function N(e){let{onComplete:t}=e,[s,o]=(0,i.useState)(null),[r,a]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{try{let e=JSON.parse(sessionStorage.getItem("interviewSession")||"{}");e&&e.topic?o(e):console.error("No valid session data found")}catch(e){console.error("Error parsing session data:",e)}finally{a(!1)}},[]),r)?(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-indigo-800",children:"Loading your interview session..."})]})}):s&&s.topic?(0,n.jsx)(j,{topic:s.topic,sessionType:s.type,details:s.details,notes:s.notes,onEnd:e=>{try{let t=sessionStorage.getItem("interviewHistory")||"[]",n=JSON.parse(t),i=n.findIndex(e=>e.id===s.id);-1!==i&&(n[i].feedback=e,sessionStorage.setItem("interviewHistory",JSON.stringify(n)))}catch(e){console.error("Error updating session history with feedback:",e)}t(e)},className:"h-[calc(100vh-64px)]"}):(0,n.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,n.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-800 p-4 rounded-lg max-w-md",children:[(0,n.jsx)("h3",{className:"font-medium text-lg mb-2",children:"Session Error"}),(0,n.jsx)("p",{children:"We couldn't find your interview session data."}),(0,n.jsx)("button",{onClick:()=>window.location.href="/dashboard",className:"mt-4 bg-red-100 text-red-800 px-4 py-2 rounded hover:bg-red-200",children:"Return to Dashboard"})]})})}var k=s(7864);function I(e){let{interviewId:t,type:s,topic:n}=e;return(0,i.useEffect)(()=>{if(t&&s&&n)try{let e={id:t,type:s,topic:n,date:new Date().toISOString()},i=sessionStorage.getItem("interviewHistory")||"[]",o=JSON.parse(i),r=o.findIndex(e=>e.id===t);if(-1===r){o.unshift(e);let s=o.slice(0,10);sessionStorage.setItem("interviewHistory",JSON.stringify(s)),console.log("Added interview to history:",t)}else console.log("Interview already exists in history:",t)}catch(e){console.error("Error saving to session history:",e)}},[t,s,n]),null}function T(){let e=(0,o.useRouter)(),[t,s]=(0,i.useState)(null),[r,a]=(0,i.useState)(null);return((0,i.useEffect)(()=>{try{let e=JSON.parse(sessionStorage.getItem("interviewSession")||"{}");e&&e.id&&a(e)}catch(e){console.error("Error parsing session data:",e)}},[]),t)?(0,n.jsxs)("main",{className:"min-h-screen bg-gray-50 flex flex-col",children:[(0,n.jsx)(k.Y,{showBackButton:!0,backHref:"/dashboard"}),(0,n.jsx)("div",{className:"flex-1 container mx-auto px-4 py-8 flex flex-col items-center",children:(0,n.jsxs)("div",{className:"max-w-3xl w-full bg-white rounded-xl shadow-md overflow-hidden",children:[(0,n.jsxs)("div",{className:"p-6 border-b",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Session Complete"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Here's your feedback"})]}),(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Summary"}),(0,n.jsx)("p",{className:"text-gray-700",children:t.summary})]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Strengths"}),(0,n.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:t.strengths.map((e,t)=>(0,n.jsx)("li",{className:"text-gray-700",children:e},t))})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-medium text-gray-900 mb-2",children:"Areas for Improvement"}),(0,n.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:t.improvements.map((e,t)=>(0,n.jsx)("li",{className:"text-gray-700",children:e},t))})]})]}),(0,n.jsx)("div",{className:"p-6 bg-gray-50 flex justify-end",children:(0,n.jsx)("button",{onClick:()=>e.push("/dashboard"),className:"bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors",children:"Return to Dashboard"})})]})})]}):(0,n.jsxs)("main",{className:"min-h-screen flex flex-col",children:[r&&(0,n.jsx)(I,{interviewId:r.id,type:r.type,topic:r.topic}),(0,n.jsx)(N,{onComplete:e=>{s(e)}})]})}},7864:(e,t,s)=>{"use strict";s.d(t,{Y:()=>l});var n=s(5155),i=s(6874),o=s.n(i),r=s(2461),a=s(1976),c=s(767);function l(e){let{showBackButton:t=!1,backHref:s="/dashboard"}=e,{isSignedIn:i,user:l,isLoaded:d}=(0,a.Jd)();return(0,n.jsx)("header",{className:"bg-white border-b border-gray-200",children:(0,n.jsxs)("div",{className:"container mx-auto px-4 py-3 flex justify-between items-center",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[t&&(0,n.jsx)(o(),{href:s,className:"mr-3 text-gray-600 hover:text-gray-900",children:(0,n.jsx)(r.A,{className:"h-5 w-5"})}),(0,n.jsx)(o(),{href:i?"/dashboard":"/",className:"text-xl font-semibold text-indigo-600 hover:text-indigo-800",children:"KnowledgeAI"})]}),(0,n.jsx)("div",{className:"flex items-center gap-3",children:d?i?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"text-sm text-gray-600",children:["Welcome, ",(null==l?void 0:l.firstName)||"User"]}),(0,n.jsx)(a.uF,{afterSignOutUrl:"/"})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.$,{asChild:!0,variant:"outline",size:"sm",className:"hidden sm:flex",children:(0,n.jsx)(o(),{href:"/sign-in",children:"Sign In"})}),(0,n.jsx)(c.$,{asChild:!0,size:"sm",children:(0,n.jsx)(o(),{href:"/sign-up",children:"Sign Up"})}),(0,n.jsx)("div",{className:"sm:hidden",children:(0,n.jsx)(c.$,{asChild:!0,variant:"outline",size:"sm",children:(0,n.jsx)(o(),{href:"/sign-in",className:"text-xs",children:"Sign In"})})})]}):(0,n.jsx)("div",{className:"h-8 w-8 rounded-full bg-gray-200 animate-pulse"})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[976,41,602,441,684,358],()=>t(2876)),_N_E=e.O()}]);